# HTTP/HTTPS协议

## HTTP协议

**官方定义**

HTTP全称超文本传输协议，是一个用于传输超媒体文档（如HTML）的<u>应用层协议</u>。

[^应用层]: 说到应用层又不得不提到TCP/IP五层网络模型，即应用层、传输层、网络层、数据链路层和物理层。
[^协议]: 是用于网络实体之间进行数据交换时必须共同遵循的、关于数据格式、语义、时序以及错误处理的一组标准化规则。

它是为Web浏览器与Web服务器之间的通信而设计的，但也可以用于其它目的。HTTP遵循经典的客户端-服务端模型，客户端打开一个连接以发出请求然后等待直到收到服务器端响应。HTTP是无状态协议，意味着服务器不会在两个请求之间保留任何数据。

**HTTP默认使用80端口，HTTP/1.x和HTTP/2使用TCP作为传输层协议。**



### HTTP报文

请求报文和响应报文都由四部分组成：

- 请求/响应行
- 请求/响应头
- 空行
- 请求/响应体



**HTTP请求报文由什么组成？**

请求行、请求头、空行和请求体。

- 请求行：包含请求方法、URI（请求的资源路径）、HTTP协议版本。
- 请求头：一些额外的附加信息，例如浏览器类型、字符编码、认证信息等等。以键值对的方式存在。
- 请求体：存放请求参数，即浏览器向服务器传输数据的实体部分。

为什么要有空行？

空行相当于请求头和请求体的分隔符，HTTP协议没有规定请求头的键值对有多少个，用空行表示请求头已结束。



**HTTP响应报文由什么组成？**

与请求报文同理，响应行、响应头、空行、响应体。

- 响应行：HTTP协议版本、状态码和状态码的原因短语。例如：HTTP/1.1 200 OK。
- 响应头：与请求头类似，以键值对的形式描述响应的一些元信息。
- 响应体：服务器响应的数据。



### 常见请求方法

- GET：向服务器获取数据。
- POST：将实体提交到指定的资源，通常会引起服务器资源改变。
- PUT：上传文件，更新数据。
- DELETE：删除服务器上的对象。
- HEAD：获取报文首部，与GET相比不返回报文主体。
- OPTIONS：询问支持的请求方法，用于跨域请求。
- CONNECT：要求在与代理服务器通信时建立隧道，使用隧道进行TCP通信。
- TRACE：回显服务器收到的请求。



### 常考面试题：

#### GET和POST区别

1. **应用场景：**GET请求是一个幂等的请求，通常用于不会对浏览器资源发生改变的场景；而POST不是幂等的请求，用于对浏览器资源会发生改变的场景。
2. **是否缓存：**浏览器一般会对GET请求缓存，很少对POST请求缓存
3. **发送的报文格式：**GET请求的请求实体一般为空，而POST的请求实体一般为向服务器发送的数据。
4. **安全性：**GET请求可以将请求的参数放入URL中向服务器发送，这对于POST来说不安全。
5. **请求长度：**由于浏览器对URL长度的限制，某种程度上也就限制了GET请求发送数据的长度。
6. **参数类型：**POST的参数传递支持更多的数据类型。而GET请求的参数只能以字符串的形式拼接在URL后面。



#### POST和PUT区别

- POST是提交资源，由服务器创建并决定其最终位置。并且POST通常是不幂等的，重复执行会产生多个资源。
- PUT是更新资源，由客户端指定资源位置并且覆盖原有资源，若指定资源原本不存在则服务器可以创建它。PUT通常是幂等的因为重复执行也只是会覆盖，结果是一样的。

通俗一点理解就是用POST多次创建用户那么就会有多个记录，但用PUT多次更新用户依旧只有那条用户，只是数据更新了。



#### HTTP1.0和HTTP1.1的区别

1. **连接方式：**HTTP1.0默认使用非持久连接（短连接），HTTP1.1默认使用长连接。

[^长连接]: 多个请求复用同一个TCP，请求结束后连接保持一段时间不立即关闭。长连接和短连接也是常考重点。

HTTP1.1通过使用长连接使多个HTTP请求复用一个TCP连接，减少每次建立连接的时延。

2. **资源请求：**HTTP1.0中存在浪费带宽的现象，如客户端只需要对象某一个部分但服务端返回了整个对象，且不支持断点续传。HTTP1.1新增Range头域允许请求资源的某个部分。
3. **缓存：**HTTP1.0中和缓存有关的请求头是`Expires`、`If-Modified-Since`，HTTP1.1中新增了`ETag`、`Cache-Control`等更多可供选择的缓存头来控制缓存策略。
4. **host字段：**HTTP1.1新增了host字段用来表示服务器的域名。
5. **请求方法：**HTTP1.1新增很多请求方法例如PUT、HEAD、OPTIONS等。



#### HTTP1.1和HTTP2.0区别

1. **二进制协议：**HTTP2.0是一个二进制协议。HTTP1.1中报文的头信息必须是文本，数据体可以是文本或二进制；HTTP2.0的报文头信息和数据体都是二进制，并且统称为“帧”，可以分为头信息帧和数据帧，帧的概念是其实现多路复用的基础。
2. **多路复用：**HTTP2.0实现了多路复用，在一个连接里客户端和服务器都可以同时发送多个请求或响应，避免了<u>队头堵塞</u>的问题。

[^队头堵塞]: 队头堵塞是由HTTP的“请求-应答”模型所导致的。HTTP规定报文必须是一发一收，且请求是没有优先级的，按照提交顺序排列，当队头的请求处理太慢就会堵塞整个队列。

3. **数据流：**HTTP/2将每个请求或响应的所有数据包成为一个数据流，每个数据流都有一个独一无二的编号用于识别数据包属于哪条数据流。
4. **头信息压缩：**HTTP/2实现了头信息压缩，由于HTTP1.1协议不带状态，每次发送请求都要附上所有信息如Cookie和User Agent等重复字段，这会浪费带宽影响速度，所以HTTP/2作出了优化，引入了头信息压缩机制。一方面，将头信息压缩后发送，另一方面将所有字段存入头信息表中，生成一个索引号，每次发送时只发送索引号，提高速度。
5. **服务器推送：**HTTP/2允许服务器主动发送资源给客户端，不需要客户端请求。这样服务器可以提前推送必要的资源，减少延迟时间。



**有关多路复用：**

HTTP/2的多路复用优化了应用层并行处理请求的效率，但对于TCP传输层并未实质上优化。

因为HTTP/2的多路复用是依靠将数据流分为多个帧实现的。原本的HTTP一发一收模式会使得一次只能处理一条请求，如果当前处理的请求很慢那么其他请求都会在后面等待，也就导致了队头堵塞。HTTP/2的多路复用则让不同Stream的Frame交叉传输，即便Stream1的请求较慢，也可以让浏览器收到Stream2的Frame实现并行处理，提高效率。

而在TCP传输层仍然是顺序传输，如果出现丢包仍然会堵塞队列，所以说没有得到实质性优化，这个问题在HTTP/3中利用QUIC得到了解决。



#### 关于长连接和短连接

上面在HTTP1.0和1.1区别中提到了长短连接。

**官方定义**

- 长连接（Keep-Alive）：同一TCP连接可承载多次请求-响应，连接保持一段时间不断开。
- 短连接：一次请求-响应完成后就断开TCP连接。

HTTP1.1中默认使用长连接，可以用`Connection:close`关闭；HTTP1.0默认使用短连接，若想使用长连接需要手动配置`Connection:keep-alive`。



**对keep-alive的理解**

------

1. **Keep-Alive建立过程：**

- 客户端向服务器发送请求时携带`Connection:keep-alive`字段，如果是HTTP1.1不用携带也默认是长连接。
- 服务端收到并处理Connection字段，如果同意长连接则返回的响应头里携带`Connection:keep-alive`字段，还有可能携带`Keep-Alive`字段指定超时时间或最大请求数等。
- 客户端收到带Keep-Alive的响应则知道长连接成功建立。



2. **开启Keep-Alive的优缺点**





#### HTTP/2的头信息压缩算法

上面提到了HTTP/2中提出的头信息压缩，底层采用的是HPACK算法。



#### HTTP协议优缺点

**优点：**

- **简单快速：**客户端向服务器发送请求时只需传递请求方法和路径，由于HTTP协议简单HTTP服务器的程序规模也较小，通信速度很快。
- **无状态：**无状态是优点也是缺点，服务器没有记忆能力也就不需要额外的资源来记录信息，实现更简单，也可以把更多的CPU和内存用来对外提供服务。

**缺点：**

- **无状态：**服务器没有记忆能力就不能完成连续多个步骤的事务操作，每次都要获取一遍身份信息增加了不必要的数据传输量。
- **明文传输不安全：**HTTP报文采用文本形式传输，内容会被窃听。



#### 说说HTTP3.0

HTTP3.0基于UDP实现了类似TCP的多路复用数据流、传输可靠性等功能，这套功能被称为QUIC协议。



## HTTPS协议

**定义**

HTTPS全称为超文本传输**安全**协议，**HTTPS经由HTTP进行通信，利用SSL/TLS来加密数据包。**HTTPS的主要目的是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。



### **SSL/TLS的工作原理**

SSL/TLS全称安全传输层协议，是一个介于HTTP和TCP之间的安全协议。

功能实现主要依赖三类算法：**散列函数、对称加密和非对称加密**。

![](https://cdn.nlark.com/yuque/0/2020/png/1500604/1603965685769-63a91dae-936d-42d3-8571-577cefa11e33.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_16%2Ctext_5b6u5L-h5YWs5LyX5Y-377ya5YmN56uv5YWF55S15a6d%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10%2Fformat%2Cwebp)



**（1）散列函数hash**



**（2）对称加密**

通信双方都使用同一个密钥进行加密/解密。

**（3）非对称加密**



**HTTPS是如何保证安全的？**





### 常考面试题

#### HTTPS优缺点

**优点：**

